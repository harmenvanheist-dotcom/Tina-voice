<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Tina Â· Voice assistent</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    :root{
      --paars:#5B2D82; --paars-dark:#462365;
      --lime:#D8FD57; --lime2:#c8fb3c;
      --card:rgba(255,255,255,.06);
      --radius-xl:22px; --radius-lg:16px;
      --gap-xl:clamp(18px,3vw,28px);
      --gap-lg:clamp(14px,2.2vw,22px);
      --gap-md:clamp(10px,1.8vw,18px);
      --maxw:1080px
    }
    body{
      margin:0; color:#f5f7fa; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(1200px 800px at 10% 0%, rgba(216,253,87,.08), transparent 60%),
        radial-gradient(900px 700px at 100% 100%, rgba(216,253,87,.06), transparent 65%),
        var(--paars);
      line-height:1.5;
      padding-top:calc(18px + env(safe-area-inset-top));
      padding-bottom:calc(24px + env(safe-area-inset-bottom));
      -webkit-text-size-adjust:100%; text-size-adjust:100%
    }
    a{color:var(--lime);text-decoration:none}
    a:hover{text-decoration:underline}

    .wrap{width:min(94vw,var(--maxw));margin:0 auto}

    .header{
      background:linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,.04));
      border:1px solid rgba(255,255,255,.08); border-radius:var(--radius-xl);
      box-shadow:0 20px 60px rgba(0,0,0,.35);
      padding:clamp(14px,2.4vw,20px) clamp(14px,2.4vw,22px)
    }
    .topline{display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:12px}
    .brand{display:flex;align-items:center;gap:10px;min-width:0}
    .brand img{width:clamp(30px,6vw,40px);height:clamp(30px,6vw,40px);border-radius:10px;display:block}
    .brand h1{margin:0;font-weight:800;font-size:clamp(22px,4.6vw,30px)}
    .sub{grid-column:1/-1;margin-top:6px;font-size:clamp(13px,2.9vw,15px);opacity:.92}
    .status{justify-self:end;color:#272C1D;background:rgba(214,255,100,.85);padding:6px 12px;border-radius:999px;font-size:clamp(12px,2.7vw,13px);border:1px solid rgba(0,0,0,.06)}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:var(--gap-xl);margin-top:var(--gap-xl)}
    @media (max-width:820px){.grid{grid-template-columns:1fr}}

    .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.18));
      border:1px solid rgba(255,255,255,.08); border-radius:var(--radius-xl);
      box-shadow:0 20px 60px rgba(0,0,0,.35); padding:clamp(16px,3vw,22px)}

    .micbox{display:grid;place-items:center;text-align:center;gap:var(--gap-md);
      min-height:clamp(220px,36vw,300px); background:linear-gradient(160deg, rgba(255,255,255,.02), rgba(0,0,0,.22));
      border:1px solid rgba(255,255,255,.06); border-radius:16px}
    .mic{width:clamp(160px,34vw,240px);height:clamp(160px,34vw,240px);border-radius:50%;display:grid;place-items:center;color:#1f1f1f;
      background:radial-gradient(60% 60% at 50% 38%, rgba(255,255,255,.35), rgba(255,255,255,0) 60%),
                 radial-gradient(70% 70% at 50% 60%, rgba(0,0,0,.25), rgba(0,0,0,0) 60%), var(--lime);
      box-shadow:0 8px 24px rgba(0,0,0,.35),0 0 0 10px rgba(214,255,100,.08);
      transition:transform .12s ease;cursor:pointer;-webkit-tap-highlight-color:transparent}
    .mic:active{transform:scale(.98)}
    .mic-emoji{font-size:clamp(56px,8.5vw,82px);filter:drop-shadow(0 4px 10px rgba(0,0,0,.3))}
    .mic-hint{opacity:.9;font-size:clamp(13px,2.9vw,15px)}

    .panel{background:linear-gradient(160deg, rgba(255,255,255,.02), rgba(0,0,0,.22));
      border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:clamp(16px,2.8vw,22px);
      min-height:clamp(240px,34vw,300px)}
    .label{color:var(--lime);font-weight:800;letter-spacing:.6px;font-size:clamp(14px,3.2vw,16px);margin-bottom:12px}
    .ghost{opacity:.8}

    /* Promo compacter, zeker mobiel */
    .promo{margin-top:var(--gap-xl);background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.18));
      border:1px solid rgba(255,255,255,.08);border-radius:var(--radius-xl);box-shadow:0 20px 60px rgba(0,0,0,.35);
      padding:clamp(14px,2.2vw,18px)}
    .promo p{margin:0 0 12px 0;font-size:clamp(14px,3.4vw,18px);line-height:1.45}
    .cta{display:inline-block;background:linear-gradient(180deg, var(--lime), var(--lime2));color:#222;font-weight:800;border-radius:999px;
      padding:clamp(10px,2.4vw,14px) clamp(16px,3.8vw,24px);box-shadow:0 12px 36px rgba(214,255,100,.35);border:1px solid rgba(0,0,0,.08)}

    .footer{margin-top:var(--gap-lg);display:flex;gap:10px;flex-wrap:wrap;align-items:baseline;font-size:clamp(12px,2.8vw,14px);opacity:.9}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="header">
      <div class="topline">
        <a class="brand" href="https://morgenacademy.nl" aria-label="Naar Morgen Academy">
          <img src="logo.png" alt="Morgen Academy logo" />
          <h1>Tina</h1>
        </a>
        <div id="status" class="status">Status: klaar</div>
        <p class="sub">Jouw personal assistent â€” bespreek waar je mee bezig bent. Tina vat samen Ã©n geeft je belangrijkste to-doâ€™s.</p>
      </div>

      <div class="grid">
        <div class="card">
          <div class="micbox">
            <button id="mic" class="mic" aria-label="Start of stop met inspreken"><span class="mic-emoji">ðŸŽ¤</span></button>
            <div class="mic-hint">Klik om te spreken. Nogmaals klikken = stoppen.</div>
            <label style="display:flex;gap:8px;align-items:center;font-size:13px;opacity:.9;margin-top:6px">
              <input id="ttsToggle" type="checkbox" /> Lees antwoorden hardop voor
            </label>
          </div>
        </div>

        <div class="card">
          <div class="panel" style="margin-bottom:var(--gap-lg)">
            <div class="label">TRANSCRIPT</div>
            <div id="transcript" class="ghost">Hier verschijnt wat je zegtâ€¦</div>
          </div>
          <div class="panel">
            <div class="label">ANTWOORD</div>
            <div id="answer" class="ghost">â€”</div>
          </div>
        </div>
      </div>
    </header>

    <section class="promo" aria-label="Morgen Academy teaser">
      <p><strong style="color:var(--lime)">Slimmer werken met AI</strong>, zodat jij tijd hebt voor leuke dingen. Of je nu elke dag in meetings zit, eindeloze to-doâ€™s hebt of je business runt in de avonden: met Morgen Academy maak je je werkdag leuker en slimmer â€” ook als je geen tech-expert bent.</p>
      <a class="cta" href="https://morgenacademy.nl" target="_blank" rel="noopener">Ontdek trainingen</a>
    </section>

    <footer class="footer">
      <div>Werkt alleen via <strong>HTTPS</strong> en na een gebruikersactie. iOS Safari: tabblad actief houden.<br/>Tina slaat geen data op; niets van wat je bespreekt of ontvangt is zichtbaar voor Morgen Academy.</div>
      <div>â€¢</div>
      <div>Prototype Â· <a href="https://morgenacademy.nl">Morgen Academy</a></div>
    </footer>
  </div>

  <script>
    const API_URL = "/.netlify/functions/ask-tina";

    const micBtn = document.getElementById('mic');
    const transcriptEl = document.getElementById('transcript');
    const answerEl = document.getElementById('answer');
    const statusEl = document.getElementById('status');
    const ttsToggle = document.getElementById('ttsToggle');

    let isRecording = false;
    let recognition = null;
    let history = []; // client-gespreksgeschiedenis

    function setStatus(s){ statusEl.textContent = s; }
    function speak(text){
      try{
        if(!ttsToggle.checked) return;
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'nl-NL';
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(u);
      }catch{}
    }

    // ---- Web Speech API (STT) fallback naar prompt
    function createRecognition(){
      const WSR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if(!WSR) return null;
      const rec = new WSR();
      rec.lang = 'nl-NL';
      rec.interimResults = true;
      rec.continuous = true;
      rec.onresult = (e)=>{
        let finalText = '', interim = '';
        for(let i=0;i<e.results.length;i++){
          const res = e.results[i];
          (res.isFinal ? finalText : interim) += res[0].transcript;
        }
        transcriptEl.textContent = (finalText || interim).trim();
        transcriptEl.classList.remove('ghost');
      };
      rec.onerror = ()=> setStatus('Status: microfoonfout');
      rec.onend = ()=> { if(isRecording){ stopRecording(); } };
      return rec;
    }

    async function startRecording(){
      // start STT
      recognition = createRecognition();
      if(recognition){
        try{ recognition.start(); }catch{}
      }
      isRecording = true;
      setStatus('Status: opnemenâ€¦');
      micBtn.classList.add('active');
    }

    function stopRecording(){
      if(recognition){
        try{ recognition.stop(); }catch{}
        recognition = null;
      }
      isRecording = false;
      micBtn.classList.remove('active');
      sendToTina();
    }

    async function sendToTina(){
      const userInput = (transcriptEl.textContent || '').trim();
      if(!userInput){ setStatus('Status: klaar'); return; }

      setStatus('Status: verwerkenâ€¦');
      answerEl.textContent = 'â€¦';
      answerEl.classList.remove('ghost');

      // history aanvullen met de nieuwe user-beurt
      history.push({ role:'user', content:userInput });

      try{
        const resp = await fetch(API_URL, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ input: userInput, history })
        });
        const data = await resp.json();
        const reply = (data && data.reply) ? data.reply : '(geen antwoord)';

        answerEl.textContent = reply;
        speak(reply);

        // assistant-beurt vastleggen, zodat vervolgvragen context hebben
        history.push({ role:'assistant', content: reply });
      }catch(err){
        console.error(err);
        answerEl.textContent = 'Fout bij ophalen antwoord.';
      }finally{
        setStatus('Status: klaar');
      }
    }

    // Mic klikken
    micBtn.addEventListener('click', ()=> {
      if(!isRecording){ startRecording(); } else { stopRecording(); }
    });

    // Fallback: tik om handmatig tekst te geven (als STT ontbreekt)
    transcriptEl.addEventListener('click', ()=>{
      if(isRecording) return;
      const t = prompt('Wat wil je aan Tina vertellen?');
      if(t){ transcriptEl.textContent = t; transcriptEl.classList.remove('ghost'); sendToTina(); }
    });
  </script>
</body>
</html>
